<html lang="en" class="scroll-smooth"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Signal - Music Data Enrichment AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://code.iconify.design/iconify-icon/1.0.7/iconify-icon.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&amp;family=JetBrains+Mono:wght@400;500&amp;display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #050505;
            color: #d4d4d8;
        }
        .font-mono {
            font-family: 'JetBrains Mono', monospace;
        }
        .glass-panel {
            background: rgba(20, 20, 22, 0.6);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
        }
        .grid-bg {
            background-image: linear-gradient(to right, #18181b 1px, transparent 1px),
            linear-gradient(to bottom, #18181b 1px, transparent 1px);
            background-size: 40px 40px;
            mask-image: radial-gradient(circle at 50% 0%, black 40%, transparent 100%);
        }
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        ::-webkit-scrollbar-track {
            background: #09090b;
        }
        ::-webkit-scrollbar-thumb {
            background: #27272a;
            border-radius: 3px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #3f3f46;
        }
        /* Custom Input Reset */
        input:focus, textarea:focus {
            outline: none;
            box-shadow: none;
        }
        .animate-pulse-slow {
            animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
    </style>
</head>
<body class="antialiased selection:bg-white selection:text-black flex flex-col min-h-screen relative overflow-x-hidden">

    <!-- Background Grid -->
    <div class="fixed inset-0 grid-bg pointer-events-none z-0 opacity-40"></div>
    
    <!-- Top Glow -->
    <div class="fixed top-0 left-1/2 -translate-x-1/2 w-[800px] h-[300px] bg-white opacity-[0.03] blur-[100px] pointer-events-none z-0 rounded-full"></div>

    <!-- Navigation -->
    <nav class="sticky top-0 z-50 border-b border-zinc-900/80 glass-panel">
        <div class="max-w-7xl mx-auto px-6 h-14 flex items-center justify-between">
            <div class="flex items-center gap-2 group cursor-pointer">
                <div class="w-4 h-4 bg-white rounded-full flex items-center justify-center">
                    <div class="w-1.5 h-1.5 bg-black rounded-full"></div>
                </div>
                <span class="text-sm font-medium tracking-tighter text-white group-hover:opacity-80 transition-opacity">SIGNAL</span>
            </div>
            <div class="hidden md:flex items-center gap-6">
                <a href="#" class="text-xs font-medium text-zinc-500 hover:text-white transition-colors">Documentation</a>
                <a href="#" class="text-xs font-medium text-zinc-500 hover:text-white transition-colors">Pricing</a>
                <a href="#" class="text-xs font-medium text-zinc-500 hover:text-white transition-colors">API</a>
                <div class="h-4 w-[1px] bg-zinc-800"></div>
                <a href="#" class="text-xs font-medium text-white hover:text-zinc-300 transition-colors">Login</a>
            </div>
            <div class="md:hidden">
                <iconify-icon icon="solar:hamburger-menu-linear" class="text-white text-xl"></iconify-icon>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="flex-grow z-10 flex flex-col items-center justify-start pt-20 md:pt-32 pb-20 px-6">
        
        <!-- Hero Section -->
        <div class="w-full max-w-3xl text-center mb-16 space-y-8">
            <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full border border-zinc-800 bg-zinc-900/50 backdrop-blur-sm">
                <span class="relative flex h-2 w-2">
                  <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"></span>
                  <span class="relative inline-flex rounded-full h-2 w-2 bg-emerald-500"></span>
                </span>
                <span class="text-xs font-medium text-zinc-400">v2.0 Model Live: Enhanced detection rate</span>
            </div>
            
            <h1 class="text-4xl md:text-6xl lg:text-7xl font-medium text-white tracking-tight leading-[1.1]">
                The intelligence layer for <br class="hidden md:block">
                <span class="text-zinc-500">electronic music.</span>
            </h1>
            
            <p class="text-base md:text-lg text-zinc-500 max-w-xl mx-auto font-light leading-relaxed">
                Transform raw URLs into comprehensive artist profiles. Our agent crawls disparate platforms to aggregate biography, imagery, and social graph data instantly.
            </p>

            <!-- Search Interface -->
            <div class="relative max-w-xl mx-auto w-full group">
                <div class="absolute -inset-0.5 bg-gradient-to-r from-zinc-700 to-zinc-800 rounded-lg blur opacity-30 group-hover:opacity-75 transition duration-500"></div>
                <div class="relative flex items-center bg-black rounded-lg border border-zinc-800 focus-within:border-zinc-600 focus-within:ring-1 focus-within:ring-zinc-600 transition-all overflow-hidden">
                    <div class="pl-4 text-zinc-500 flex items-center">
                        <iconify-icon icon="solar:link-linear" width="20" stroke-width="1.5"></iconify-icon>
                    </div>
                    <input type="text" placeholder="https://ra.co/dj/artist-name..." class="w-full bg-transparent border-none text-white text-sm px-4 py-4 placeholder-zinc-600 font-mono">
                    <button class="mr-1.5 px-4 py-2 bg-white text-black text-xs font-medium rounded hover:bg-zinc-200 transition-colors flex items-center gap-2">
                        Enrich
                        <iconify-icon icon="solar:arrow-right-linear" width="16"></iconify-icon>
                    </button>
                </div>
                <div class="mt-3 flex items-center justify-center gap-4 text-xs text-zinc-600">
                    <span class="flex items-center gap-1"><iconify-icon icon="solar:check-circle-linear" class="text-zinc-500"></iconify-icon> Artists</span>
                    <span class="flex items-center gap-1"><iconify-icon icon="solar:check-circle-linear" class="text-zinc-500"></iconify-icon> Venues</span>
                    <span class="flex items-center gap-1"><iconify-icon icon="solar:check-circle-linear" class="text-zinc-500"></iconify-icon> Promoters</span>
                </div>
            </div>
        </div>

        <!-- Data Visualization / Demo -->
        <div class="w-full max-w-6xl mt-12">
            <div class="grid grid-cols-1 lg:grid-cols-12 gap-6 items-start">
                
                <!-- Terminal Log (Left) -->
                <div class="lg:col-span-4 space-y-4">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-xs font-mono text-zinc-500 uppercase tracking-wider">Agent Logs</span>
                        <div class="flex gap-1">
                            <div class="w-1.5 h-1.5 rounded-full bg-zinc-800"></div>
                            <div class="w-1.5 h-1.5 rounded-full bg-zinc-800"></div>
                            <div class="w-1.5 h-1.5 rounded-full bg-zinc-800"></div>
                        </div>
                    </div>
                    <div class="bg-[#0A0A0A] border border-zinc-900 rounded-lg p-4 font-mono text-xs leading-6 h-[400px] overflow-hidden relative">
                        <div class="absolute top-0 left-0 w-full h-12 bg-gradient-to-b from-[#0A0A0A] to-transparent z-10 pointer-events-none"></div>
                        <div class="space-y-2 opacity-80">
                            <div class="flex gap-2 text-zinc-600">
                                <span>10:42:01</span>
                                <span class="text-blue-500">INFO</span>
                                <span>Input received: ra.co/dj/fourtet</span>
                            </div>
                            <div class="flex gap-2 text-zinc-600">
                                <span>10:42:01</span>
                                <span class="text-purple-500">SCAN</span>
                                <span>Parsing RA URL &rarr; artist/fourtet</span>
                            </div>
                            <div class="flex gap-2 text-zinc-600">
                                <span>10:42:02</span>
                                <span class="text-purple-500">CRAWL</span>
                                <span>Fetching RA GraphQL via proxy...</span>
                            </div>
                            <div class="flex gap-2 text-zinc-600">
                                <span>10:42:03</span>
                                <span class="text-green-500">FOUND</span>
                                <span>Four Tet (United Kingdom)</span>
                            </div>
                            <div class="flex gap-2 text-zinc-600">
                                <span>10:42:03</span>
                                <span class="text-purple-500">SCAN</span>
                                <span>Gap analysis: missing instagram, soundcloud</span>
                            </div>
                            <div class="flex gap-2 text-zinc-600">
                                <span>10:42:04</span>
                                <span class="text-purple-500">CRAWL</span>
                                <span>Searching Instagram via HikerAPI...</span>
                            </div>
                            <div class="flex gap-2 text-zinc-600">
                                <span>10:42:04</span>
                                <span class="text-purple-500">CRAWL</span>
                                <span>Searching SoundCloud API...</span>
                            </div>
                            <div class="flex gap-2 text-zinc-600">
                                <span>10:42:05</span>
                                <span class="text-green-500">FOUND</span>
                                <span>Instagram: @fourtetkieran (92% match)</span>
                            </div>
                            <div class="flex gap-2 text-zinc-600">
                                <span>10:42:05</span>
                                <span class="text-green-500">FOUND</span>
                                <span>SoundCloud: four-tet (95% match)</span>
                            </div>
                            <div class="flex gap-2 text-zinc-600">
                                <span>10:42:06</span>
                                <span class="text-yellow-500">ASYNC</span>
                                <span>Profile picture resolved (instagram)</span>
                            </div>
                            <div class="flex gap-2 text-zinc-600">
                                <span>10:42:06</span>
                                <span class="text-yellow-500">ASYNC</span>
                                <span>Biography resolved (ra)</span>
                            </div>
                             <div class="flex gap-2 text-zinc-600 border-t border-dashed border-zinc-800 pt-2 mt-2">
                                <span>10:42:07</span>
                                <span class="text-white">DONE</span>
                                <span>Enrichment complete: 14 fields</span>
                            </div>
                        </div>
                         <div class="absolute bottom-0 left-0 w-full h-24 bg-gradient-to-t from-[#0A0A0A] to-transparent z-10 pointer-events-none"></div>
                    </div>
                </div>

                <!-- Result Card (Right) -->
                <div class="lg:col-span-8">
                     <div class="flex items-center justify-between mb-2">
                        <span class="text-xs font-mono text-zinc-500 uppercase tracking-wider">Enriched Entity</span>
                        <div class="flex items-center gap-2">
                             <span class="text-xs text-zinc-500">JSON</span>
                             <div class="w-px h-3 bg-zinc-800"></div>
                             <span class="text-xs text-white">Visual</span>
                        </div>
                    </div>
                    
                    <div id="result-card" class="bg-zinc-900/30 border border-zinc-800 rounded-lg p-1 overflow-hidden backdrop-blur-sm">
                        <!-- Card Content -->
                        <div class="bg-black border border-zinc-800/50 rounded overflow-hidden">
                            <!-- Cover/Header -->
                            <div class="h-32 bg-zinc-900 relative border-b border-zinc-800">
                                <div id="cover-bg" class="absolute inset-0 opacity-20 bg-cover bg-center mix-blend-luminosity"></div>
                                <div class="absolute bottom-4 left-6 flex items-end gap-4 translate-y-1/2 z-10">
                                    <div class="w-20 h-20 bg-zinc-800 rounded border-2 border-black flex items-center justify-center overflow-hidden">
                                        <iconify-icon id="profile-pic-placeholder" icon="solar:user-circle-linear" class="text-zinc-600 text-4xl"></iconify-icon>
                                        <img id="profile-pic" src="" class="w-full h-full object-cover grayscale hidden" alt="Entity" referrerpolicy="no-referrer" onerror="this.classList.add('hidden'); document.getElementById('profile-pic-placeholder').classList.remove('hidden');">
                                    </div>
                                    <div class="pb-1">
                                        <h2 id="entity-name" class="text-xl font-medium text-white tracking-tight text-zinc-600">Awaiting input...</h2>
                                        <p id="entity-location" class="text-xs text-zinc-500"></p>
                                    </div>
                                </div>
                                <div class="absolute top-4 right-4 flex gap-2">
                                    <span id="entity-type-badge" class="px-2 py-0.5 rounded text-[10px] uppercase font-medium bg-zinc-800 text-zinc-400 border border-zinc-700 hidden"></span>
                                </div>
                            </div>

                            <!-- Body -->
                            <div class="pt-14 px-6 pb-6">
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-8">

                                    <!-- Bio Column -->
                                    <div class="md:col-span-2 space-y-4">
                                        <div>
                                            <h3 class="text-xs font-mono text-zinc-500 uppercase mb-2">Biography</h3>
                                            <p id="entity-bio" class="text-sm text-zinc-300 leading-relaxed font-light">
                                                <span class="text-zinc-600 italic">Paste a Resident Advisor URL above and click Enrich to see results here.</span>
                                            </p>
                                        </div>

                                        <!-- Stats Grid -->
                                        <div id="stats-grid" class="grid grid-cols-3 gap-2 mt-4">
                                            <div class="p-3 border border-zinc-800 bg-zinc-900/20 rounded">
                                                <div class="text-[10px] text-zinc-500 uppercase">RA Followers</div>
                                                <div class="text-sm text-zinc-600 font-mono mt-1">&mdash;</div>
                                            </div>
                                            <div class="p-3 border border-zinc-800 bg-zinc-900/20 rounded">
                                                <div class="text-[10px] text-zinc-500 uppercase">Fields Found</div>
                                                <div class="text-sm text-zinc-600 font-mono mt-1">&mdash;</div>
                                            </div>
                                            <div class="p-3 border border-zinc-800 bg-zinc-900/20 rounded">
                                                <div class="text-[10px] text-zinc-500 uppercase">Time</div>
                                                <div class="text-sm text-zinc-600 font-mono mt-1">&mdash;</div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Links Column -->
                                    <div class="space-y-4">
                                        <h3 class="text-xs font-mono text-zinc-500 uppercase mb-2">Identities Found</h3>
                                        <div id="links-container" class="space-y-2">
                                            <div class="flex items-center gap-3 p-2 rounded border border-zinc-800/30 opacity-40">
                                                <iconify-icon icon="mdi:instagram" class="text-zinc-500"></iconify-icon>
                                                <span class="text-xs text-zinc-500 flex-grow">Instagram</span>
                                                <span class="text-[10px] text-zinc-600">Pending</span>
                                            </div>
                                            <div class="flex items-center gap-3 p-2 rounded border border-zinc-800/30 opacity-40">
                                                <iconify-icon icon="mdi:soundcloud" class="text-zinc-500"></iconify-icon>
                                                <span class="text-xs text-zinc-500 flex-grow">SoundCloud</span>
                                                <span class="text-[10px] text-zinc-600">Pending</span>
                                            </div>
                                            <div class="flex items-center gap-3 p-2 rounded border border-zinc-800/30 opacity-40">
                                                <iconify-icon icon="solar:globe-linear" class="text-zinc-500"></iconify-icon>
                                                <span class="text-xs text-zinc-500 flex-grow">Website</span>
                                                <span class="text-[10px] text-zinc-600">Pending</span>
                                            </div>
                                            <div class="flex items-center gap-3 p-2 rounded border border-zinc-800/30 opacity-40">
                                                <iconify-icon icon="mdi:facebook" class="text-zinc-500"></iconify-icon>
                                                <span class="text-xs text-zinc-500 flex-grow">Facebook</span>
                                                <span class="text-[10px] text-zinc-600">Pending</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Features Grid -->
        <div class="w-full max-w-6xl mt-32 mb-16">
            <h3 class="text-xl font-medium text-white mb-8 tracking-tight">Capabilities</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                
                <!-- Card 1 -->
                <div class="group p-6 rounded-lg border border-zinc-900 bg-zinc-950/50 hover:border-zinc-700 transition-all duration-300">
                    <div class="w-10 h-10 bg-zinc-900 rounded-lg flex items-center justify-center mb-4 border border-zinc-800 group-hover:bg-zinc-800 transition-colors">
                        <iconify-icon icon="solar:magnifer-linear" class="text-white text-xl"></iconify-icon>
                    </div>
                    <h4 class="text-sm font-medium text-white mb-2">Cross-Platform Resolution</h4>
                    <p class="text-xs text-zinc-500 leading-relaxed">
                        Input a Resident Advisor link, get their Instagram, SoundCloud, and enriched profile data with confidence scoring.
                    </p>
                </div>

                <!-- Card 2 -->
                <div class="group p-6 rounded-lg border border-zinc-900 bg-zinc-950/50 hover:border-zinc-700 transition-all duration-300">
                    <div class="w-10 h-10 bg-zinc-900 rounded-lg flex items-center justify-center mb-4 border border-zinc-800 group-hover:bg-zinc-800 transition-colors">
                        <iconify-icon icon="solar:database-linear" class="text-white text-xl"></iconify-icon>
                    </div>
                    <h4 class="text-sm font-medium text-white mb-2">Metadata Standardization</h4>
                    <p class="text-xs text-zinc-500 leading-relaxed">
                        Normalize genres, locations, and artist names across disparate data sources into a single schema.
                    </p>
                </div>

                <!-- Card 3 -->
                <div class="group p-6 rounded-lg border border-zinc-900 bg-zinc-950/50 hover:border-zinc-700 transition-all duration-300">
                    <div class="w-10 h-10 bg-zinc-900 rounded-lg flex items-center justify-center mb-4 border border-zinc-800 group-hover:bg-zinc-800 transition-colors">
                        <iconify-icon icon="solar:gallery-wide-linear" class="text-white text-xl"></iconify-icon>
                    </div>
                    <h4 class="text-sm font-medium text-white mb-2">Asset Retrieval</h4>
                    <p class="text-xs text-zinc-500 leading-relaxed">
                        Automatically fetch high-resolution press photos, logos, and artwork covers for any entity.
                    </p>
                </div>

            </div>
        </div>

        <!-- API Preview Section -->
        <div class="w-full max-w-6xl py-12 border-t border-zinc-900">
             <div class="flex flex-col md:flex-row items-center justify-between gap-8">
                 <div class="space-y-4 max-w-md">
                     <h3 class="text-2xl font-medium text-white tracking-tight">Built for developers</h3>
                     <p class="text-sm text-zinc-500 font-light">Integrate our enrichment engine directly into your booking platform, CRM, or music app with a few lines of code.</p>
                     <div class="flex gap-4 pt-2">
                        <button class="px-4 py-2 bg-white text-black text-xs font-medium rounded hover:bg-zinc-200 transition-colors">Get API Key</button>
                        <button class="px-4 py-2 bg-transparent border border-zinc-700 text-white text-xs font-medium rounded hover:border-zinc-500 transition-colors">Read Docs</button>
                     </div>
                 </div>
                 <div class="w-full md:w-1/2 bg-[#0d0d0d] rounded-lg border border-zinc-800 p-4 font-mono text-[10px] md:text-xs text-zinc-400 overflow-x-auto">
<pre><code><span class="text-purple-400">const</span> <span class="text-blue-400">signal</span> = <span class="text-purple-400">new</span> <span class="text-yellow-200">SignalClient</span>(<span class="text-green-400">'sk_live_...'</span>);

<span class="text-purple-400">const</span> <span class="text-blue-400">artist</span> = <span class="text-purple-400">await</span> <span class="text-blue-400">signal</span>.<span class="text-yellow-200">enrich</span>({
  url: <span class="text-green-400">'https://ra.co/dj/ben-ufo'</span>
});

console.<span class="text-yellow-200">log</span>(<span class="text-blue-400">artist</span>.instagram);
<span class="text-zinc-600">// Output: "https://instagram.com/baborufo"</span></code></pre>
                 </div>
             </div>
        </div>

    </main>

    <footer class="border-t border-zinc-900/80 bg-black pt-12 pb-8 px-6">
        <div class="max-w-7xl mx-auto flex flex-col md:flex-row justify-between items-start md:items-center gap-8">
            <div>
                 <div class="flex items-center gap-2 mb-4">
                    <div class="w-3 h-3 bg-white rounded-full flex items-center justify-center">
                        <div class="w-1 h-1 bg-black rounded-full"></div>
                    </div>
                    <span class="text-xs font-medium tracking-tighter text-white">SIGNAL</span>
                </div>
                <p class="text-[10px] text-zinc-600">© 2024 Signal Data Inc. <br>Mapping the music industry.</p>
            </div>
            <div class="flex gap-8">
                <div class="flex flex-col gap-2">
                    <span class="text-xs font-medium text-white mb-1">Product</span>
                    <a href="#" class="text-[10px] text-zinc-500 hover:text-zinc-300">Features</a>
                    <a href="#" class="text-[10px] text-zinc-500 hover:text-zinc-300">API</a>
                    <a href="#" class="text-[10px] text-zinc-500 hover:text-zinc-300">Pricing</a>
                </div>
                <div class="flex flex-col gap-2">
                    <span class="text-xs font-medium text-white mb-1">Company</span>
                    <a href="#" class="text-[10px] text-zinc-500 hover:text-zinc-300">About</a>
                    <a href="#" class="text-[10px] text-zinc-500 hover:text-zinc-300">Blog</a>
                    <a href="#" class="text-[10px] text-zinc-500 hover:text-zinc-300">Legal</a>
                </div>
                 <div class="flex flex-col gap-2">
                    <span class="text-xs font-medium text-white mb-1">Social</span>
                    <a href="#" class="text-[10px] text-zinc-500 hover:text-zinc-300">Twitter</a>
                    <a href="#" class="text-[10px] text-zinc-500 hover:text-zinc-300">GitHub</a>
                    <a href="#" class="text-[10px] text-zinc-500 hover:text-zinc-300">Discord</a>
                </div>
            </div>
        </div>
    </footer>


<script>
    // RA Enrichment Pipeline - Frontend Logic
    const API_BASE = window.location.origin;

    // Icon mapping for link fields
    const LINK_ICONS = {
        instagram: 'mdi:instagram',
        soundcloud: 'mdi:soundcloud',
        website: 'solar:globe-linear',
        facebook: 'mdi:facebook',
        twitter: 'mdi:twitter',
        bandcamp: 'simple-icons:bandcamp',
        discogs: 'simple-icons:discogs'
    };

    // Fields that represent clickable links
    const LINK_FIELDS = ['instagram', 'soundcloud', 'website', 'facebook', 'twitter', 'bandcamp', 'discogs'];

    // DOM Elements
    const urlInput = document.querySelector('input[type="text"]');
    const enrichBtn = document.querySelector('button');
    const logContainer = document.querySelector('.font-mono.text-xs.leading-6');

    // State
    let isLoading = false;

    // Utility: Format timestamp
    function formatTime() {
        const now = new Date();
        return now.toTimeString().split(' ')[0];
    }

    // Utility: Add log entry
    function addLog(type, message) {
        const colors = {
            'INFO': 'text-blue-500',
            'SCAN': 'text-purple-500',
            'FOUND': 'text-green-500',
            'CRAWL': 'text-purple-500',
            'ASYNC': 'text-yellow-500',
            'ERROR': 'text-red-500',
            'DONE': 'text-white'
        };

        const logDiv = logContainer.querySelector('.space-y-2');
        const entry = document.createElement('div');
        entry.className = 'flex gap-2 text-zinc-600';
        entry.innerHTML = `
            <span>${formatTime()}</span>
            <span class="${colors[type] || 'text-zinc-500'}">${type}</span>
            <span>${message}</span>
        `;
        logDiv.appendChild(entry);
        logContainer.scrollTop = logContainer.scrollHeight;
    }

    // Clear logs
    function clearLogs() {
        const logDiv = logContainer.querySelector('.space-y-2');
        logDiv.innerHTML = '';
    }

    // Confidence dot color
    function confidenceDot(confidence) {
        if (confidence >= 0.8) return 'bg-emerald-500';
        if (confidence >= 0.6) return 'bg-yellow-500';
        return 'bg-red-500';
    }

    // Format large numbers (e.g. 48200 -> "48.2K")
    function formatCount(n) {
        if (n == null) return '—';
        if (n >= 1000000) return (n / 1000000).toFixed(1) + 'M';
        if (n >= 1000) return (n / 1000).toFixed(1) + 'K';
        return String(n);
    }

    // Update result card with enrichment data
    function updateResultCard(data) {
        const fields = data.enriched_fields || {};

        // Profile picture
        const profilePic = document.getElementById('profile-pic');
        const profilePicPlaceholder = document.getElementById('profile-pic-placeholder');
        const picUrl = fields.profile_picture?.value;
        if (picUrl && profilePic) {
            profilePic.src = `${API_BASE}/proxy-image?url=${encodeURIComponent(picUrl)}`;
            profilePic.classList.remove('hidden');
            profilePicPlaceholder.classList.add('hidden');
        }

        // Cover image (use RA cover_picture if available)
        const coverBg = document.getElementById('cover-bg');
        const coverUrl = fields.cover_picture?.value;
        if (coverUrl && coverBg) {
            coverBg.style.backgroundImage = `url('${API_BASE}/proxy-image?url=${encodeURIComponent(coverUrl)}')`;

        }

        // Name
        const nameEl = document.getElementById('entity-name');
        if (nameEl) {
            nameEl.textContent = data.entity_name || 'Unknown';
            nameEl.classList.remove('text-zinc-600');
        }

        // Location
        const locationEl = document.getElementById('entity-location');
        if (locationEl) {
            const city = fields.city?.value;
            const country = fields.country?.value;
            const parts = [city, country].filter(Boolean);
            locationEl.textContent = parts.join(', ') || '';
        }

        // Entity type badge
        const badge = document.getElementById('entity-type-badge');
        if (badge && data.entity_type) {
            badge.textContent = data.entity_type;
            badge.classList.remove('hidden');
        }

        // Biography
        const bioEl = document.getElementById('entity-bio');
        if (bioEl) {
            const bio = fields.biography?.value;
            const bioSource = fields.biography?.source;
            if (bio) {
                bioEl.innerHTML = `${bio} <span class="text-zinc-600">[Source: ${bioSource || 'unknown'}]</span>`;
            } else {
                bioEl.innerHTML = '<span class="text-zinc-600 italic">No biography found.</span>';
            }
        }

        // Stats
        const statsGrid = document.getElementById('stats-grid');
        if (statsGrid) {
            const followerCount = fields.follower_count?.value;
            const fieldsFound = Object.values(fields).filter(f => f && f.value).length;
            const timeMs = data.processing_time_ms;

            statsGrid.innerHTML = `
                <div class="p-3 border border-zinc-800 bg-zinc-900/20 rounded">
                    <div class="text-[10px] text-zinc-500 uppercase">RA Followers</div>
                    <div class="text-sm text-white font-mono mt-1">${formatCount(followerCount)}</div>
                </div>
                <div class="p-3 border border-zinc-800 bg-zinc-900/20 rounded">
                    <div class="text-[10px] text-zinc-500 uppercase">Fields Found</div>
                    <div class="text-sm text-white font-mono mt-1">${fieldsFound}</div>
                </div>
                <div class="p-3 border border-zinc-800 bg-zinc-900/20 rounded">
                    <div class="text-[10px] text-zinc-500 uppercase">Time</div>
                    <div class="text-sm text-white font-mono mt-1">${timeMs ? (timeMs / 1000).toFixed(1) + 's' : '—'}</div>
                </div>
            `;
        }

        // Links
        const linksContainer = document.getElementById('links-container');
        if (linksContainer) {
            let html = '';

            LINK_FIELDS.forEach(field => {
                const info = fields[field];
                const icon = LINK_ICONS[field] || 'solar:link-linear';
                const label = field.charAt(0).toUpperCase() + field.slice(1);

                if (info && info.value) {
                    const conf = info.confidence != null ? info.confidence : 1;
                    const dotColor = confidenceDot(conf);
                    html += `
                        <a href="${info.value}" target="_blank" rel="noopener" class="flex items-center gap-3 p-2 rounded border border-zinc-800/60 hover:bg-zinc-900/50 transition-colors group">
                            <iconify-icon icon="${icon}" class="text-zinc-400 group-hover:text-white"></iconify-icon>
                            <span class="text-xs text-zinc-400 group-hover:text-white flex-grow">${label}</span>
                            <span class="w-2 h-2 rounded-full ${dotColor} inline-block" title="${Math.round(conf * 100)}% confidence"></span>
                            <iconify-icon icon="solar:arrow-right-up-linear" class="text-zinc-600 text-[10px]"></iconify-icon>
                        </a>
                    `;
                } else {
                    html += `
                        <div class="flex items-center gap-3 p-2 rounded border border-zinc-800/30 opacity-40">
                            <iconify-icon icon="${icon}" class="text-zinc-500"></iconify-icon>
                            <span class="text-xs text-zinc-500 flex-grow">${label}</span>
                            <span class="text-[10px] text-zinc-600">Not found</span>
                        </div>
                    `;
                }
            });

            linksContainer.innerHTML = html;
        }
    }

    // Enrich entity
    async function enrichEntity(url) {
        if (isLoading) return;
        isLoading = true;

        clearLogs();
        enrichBtn.disabled = true;
        enrichBtn.innerHTML = `
            <svg class="animate-spin h-4 w-4 mr-2" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" fill="none"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            Enriching...
        `;

        // Extract short path for display
        const shortUrl = url.replace(/^https?:\/\/(www\.)?/, '');
        addLog('INFO', `Input received: ${shortUrl}`);
        addLog('SCAN', 'Parsing RA URL...');

        try {
            const response = await fetch(`${API_BASE}/enrich`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ url })
            });

            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.detail || 'Enrichment failed');
            }

            const data = await response.json();

            // Log pipeline stages
            addLog('CRAWL', 'Fetching RA GraphQL via proxy...');
            addLog('FOUND', `${data.entity_name || 'Entity'} (${data.entity_type || 'unknown'})`);

            // Log discovery agents
            const fields = data.enriched_fields || {};
            const missingFields = [];
            LINK_FIELDS.slice(0, 2).forEach(f => {
                if (!fields[f]?.value) missingFields.push(f);
            });

            if (missingFields.length > 0) {
                addLog('SCAN', `Gap analysis: missing ${missingFields.join(', ')}`);
                if (missingFields.includes('instagram')) {
                    addLog('CRAWL', 'Searching Instagram via HikerAPI...');
                }
                if (missingFields.includes('soundcloud')) {
                    addLog('CRAWL', 'Searching SoundCloud API...');
                }
            }

            // Log found fields
            Object.entries(fields).forEach(([field, info]) => {
                if (info && info.value && LINK_FIELDS.includes(field)) {
                    const conf = info.confidence != null ? Math.round(info.confidence * 100) : 100;
                    addLog('FOUND', `${field}: ${info.source || 'ra'} (${conf}% match)`);
                }
            });

            // Log resolution
            if (fields.profile_picture?.value) {
                addLog('ASYNC', `Profile picture resolved (${fields.profile_picture.source || 'unknown'})`);
            }
            if (fields.biography?.value) {
                addLog('ASYNC', `Biography resolved (${fields.biography.source || 'unknown'})`);
            }

            const fieldsFound = Object.values(fields).filter(f => f && f.value).length;
            addLog('DONE', `Enrichment complete: ${fieldsFound} fields`);

            updateResultCard(data);

        } catch (error) {
            addLog('ERROR', error.message);
            console.error('Enrichment error:', error);
        } finally {
            isLoading = false;
            enrichBtn.disabled = false;
            enrichBtn.innerHTML = `
                Enrich
                <iconify-icon icon="solar:arrow-right-linear" width="16"></iconify-icon>
            `;
        }
    }

    // Event listeners
    enrichBtn.addEventListener('click', () => {
        const url = urlInput.value.trim();
        if (url) {
            enrichEntity(url);
        }
    });

    urlInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            const url = urlInput.value.trim();
            if (url) {
                enrichEntity(url);
            }
        }
    });
</script>

</body></html>